<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Surgical Pathways Sankey Diagram</title>
    <link rel="stylesheet" href="style.css">
    <script type="module" src="global.js"></script>
    <script type="module" src="question.js"></script>
</head>
<body>
    <!-- Styling for the head container -->
    <div class="header-container">
        <h1>How long will a patient stay in the hospital to recover from surgery?</h1>
        <div class="description">
            <p>Have you ever thought about what happens when you undergo surgery? You likely have questions going through your mind, such as:</p>
                <p class="highlight">"Will I survive?"</p>
                <p class="highlight">"How long do I need to recover?"</p>
            <p>To help alleviate these concerns, we investigated data from patients undergoing surgery at the Seoul National University Hospital, Republic of Korea.</p>
        </div>
    </div>

    <!-- Text info for surgical departments -->
    <div class="surgery-departments-container">
        <h1>Surgical Departments</h1>
        <p>At the Seoul National University Hospital, surgeries fall under 4 general categories:</p>
        
        <h2 class="collapse">
            <span class="toggle-indicator">&#9656;</span> General Surgery
        </h2>
        <div class="content">
            <p>Most surgeries fall under this department. General surgery covers, but is not limited to:</p>
            <ul>
                <li class="emphasis">Head and Neck</li>
                <li class="emphasis">Digestive System</li>
                <li class="emphasis">Abdomen & Internal Organs</li>
                <li class="emphasis">Breast, Skin, and Soft Tissue</li>
                <li class="emphasis">Blood Vessels</li>
                <li class="emphasis">Hormonal Glands</li>
                <li class="emphasis">Cancer Surgery</li>
                <li class="emphasis">Trauma Care</li>
                <li class="emphasis">Emergency and ICU Care</li>
            </ul>
        </div>

        <h2 class="collapse">
            <span class="toggle-indicator">&#9656;</span> Gynecology
        </h2>
        <div class="content">
            <p>This department covers surgeries related to the female reproductive system. This includes:</p>
            <ul>
                <li class="emphasis">Uterus</li>
                <li class="emphasis">Ovaries</li>
                <li class="emphasis">Cervix</li>
                <li class="emphasis">Fallopian Tubes</li>
                <li class="emphasis">Vagina and Vulva</li>
            </ul>
        </div>

        <h2 class="collapse">
            <span class="toggle-indicator">&#9656;</span> Thoracic
        </h2>
        <div class="content">
            <p>This department specializes in surgeries involving the chest organs, including:</p>
            <ul>
                <li class="emphasis">Heart</li>
                <li class="emphasis">Lungs</li>
                <li class="emphasis">Esophagus</li>
                <li class="emphasis">Trachea</li>
            </ul>
        </div>

        <h2 class="collapse">
            <span class="toggle-indicator">&#9656;</span> Urological
        </h2>
        <div class="content">
            <p>
                This department addresses two major fields: the urinary tract and the male reproductive system. Organs that may be operated on include, but are not limited to:
            </p>
            <ul>
                <li class="emphasis">Kidneys</li>
                <li class="emphasis">Ureters</li>
                <li class="emphasis">Bladder and Urethra</li>
                <li class="emphasis">Penis</li>
                <li class="emphasis">Testes</li>
                <li class="emphasis">Scrotum</li>
                <li class="emphasis">Prostate</li>
            </ul>
        </div>
    </div>


    <!-- The first set of images -->
    <div class="image-container-departments">
        <div class="image-wrapper">
            <img src="./images/digestive.avif" alt="Organs treated in General Surgery" title="The digestive system, addressed in the general surgery department">
        </div>
        <div class="image-wrapper">
            <img src="./images/gynecology_white.jpg" alt="Organs treated in Gynecological Surgery" title="The female reproductive system, addressed in gynecology surgery department">
        </div>
        <div class="image-wrapper">
            <img src="./images/thoracic.jpg" alt="Organs treated in Thoracic Surgery" title="The thoracic system, addressed in the thoracic surgery department">
        </div>
        <div class="image-wrapper">
            <img src="./images/urology.jpg" alt="Organs treated in Urology Surgery" title="The urinary system, addressed in the urology surgery department">
        </div>
    </div>

    <!-- Container for the questionnaire section -->
    <div class="questionnaire-section">
        <div id="questionnaire-container"></div>
    </div>

     <!-- The second set of images -->
     <div class="image-container-surgery-types">
        <div class="image-wrapper">
            <img src="./images/open_surgery.jpg" alt="Open Surgery" title="Open surgery being performed on a patient">
        </div>
        <div class="image-wrapper">
            <img src="./images/videoscopic_surgery.jpeg" alt="Videoscopic Surgery" title="A videoscopic endoscapic mitral valve repair">
        </div>
        <div class="image-wrapper">
            <img src="./images/robotic_surgery.png" alt="Robotic Surgery" title="A robotic-assisted surgery being performed on a patient.">
        </div>
    </div>

    <!-- Info block for Sankey Diagram -->
    <div class="sankey-info-container">
        <h1>Putting it all together</h1>
        <div class="description">
            <p>Take a step back to see how different surgical departments compare.</p>
            <p>The interactive Sankey diagram below visualizes patient pathways across different surgical departments. The diagram tracks how patients flow from four surgical departments (General Surgery, Gynecology, Thoracic Surgery, and Urology) through various surgical approaches (Open, Robotic, and Videoscopic) to their recovery outcomes. You can hover over connections to see detailed patient flow statistics, or click on specific nodes to filter the diagram and focus on particular pathways. Use the animation controls below to see how the diagram builds step by step, revealing patterns in surgical outcomes across departments and approaches. The width of each flow represents the volume of patients following that particular pathway.</p>            
            <p>Interact with the Sankey Diagram and see:</p>
            <ul>
                <li class="highlight">Surgical Departments</p>
                <li class="highlight">Types of Surgeries Performed</p>
                <li class="highlight">Patient Recovery Outcomes</p>
            </ul>
            <!-- <p>The diagram depicts the flow from the surgical departments into operation types (open, videoscopic, robotic), and then the outcomes.</p> -->
        </div>
    </div>

    <!-- The interactive features for the Sankey Diagram -->
    <div class="container">
        <div class="flex-container">
            <div class="info-box">
                <strong>How to interact:</strong>
                <ul>
                    <li>Hover over connections to see the patient flow</li>
                    <li>Click on a node to filter the diagram and focus on that pathway</li>
                    <li>Use the animation controls to see the diagram build step by step</li>
                    <li>Use the Reset button to clear any filters and return to the full view</li>
                </ul>
            </div>
            <div class="legend-container"></div>
        </div>

        <div class="step-indicator">
            <button class="step sankey-step">1<div class="step-line"></div></button>
            <button class="step sankey-step">2<div class="step-line"></div></button>
            <button class="step sankey-step">3</button>
        </div>
        
        <div class="controls">
            <button id="resetBtn">Reset View</button>
            <button id="animateBtn">Animate Diagram</button>
            <button id="prevBtn" disabled>Previous Step</button>
            <button id="nextBtn">Next Step</button>
        </div>
        
        <div id="chart"></div>
    </div>

    <!-- External scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-sankey/0.12.3/d3-sankey.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
</body>
</html>